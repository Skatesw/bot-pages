<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–Ω–µ–≤–Ω–∏–∫ –≠–º–æ—Ü–∏–π</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #8a4fff;
            --secondary-color: #ff6b6b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f4ff;
            color: #333;
        }

        .emotion-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }

        .emotion-card:hover {
            transform: translateY(-5px);
        }

        .emotion-emoji {
            font-size: 2.5rem;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--primary-color);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--secondary-color);
            border: 3px solid white;
        }

        #emotionCanvas {
            max-height: 300px;
        }
    </style>
</head>
<body>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
    <div class="container py-4">
        <div class="text-center mb-4">
            <h1 class="display-5">üåº –î–Ω–µ–≤–Ω–∏–∫ –≠–º–æ—Ü–∏–π</h1>
            <p class="text-muted">–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</p>
        </div>

        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="emotion-card p-4 h-100">
                    <h3>üìÖ –°–µ–≥–æ–¥–Ω—è</h3>
                    <div id="todayEmotion" class="text-center py-3">
                        <div class="emotion-emoji">üòä</div>
                        <h4>–†–∞–¥–æ—Å—Ç–Ω—ã–π</h4>
                        <canvas id="emotionChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="emotion-card p-4 h-100">
                    <h3>üéØ –ú–æ—è —Ü–µ–ª—å</h3>
                    <div class="form-group mb-3">
                        <textarea class="form-control" id="goalText" rows="3" placeholder="–ö–∞–∫–∞—è —É —Ç–µ–±—è —Ü–µ–ª—å?"></textarea>
                    </div>
                    <button id="analyzeGoal" class="btn btn-primary w-100">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
                    <div id="goalAdvice" class="mt-3" style="display: none;">
                        <div class="alert alert-info">
                            <strong>–°–æ–≤–µ—Ç:</strong> <span id="adviceText"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="emotion-card p-4 mb-4">
            <h3 class="mb-3">üìù –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</h3>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <button class="btn btn-outline-primary w-100 py-3" data-type="text">
                        ‚úèÔ∏è –¢–µ–∫—Å—Ç
                    </button>
                </div>
                <div class="col-md-4 mb-3">
                    <button class="btn btn-outline-primary w-100 py-3" data-type="photo">
                        üì∏ –§–æ—Ç–æ
                    </button>
                </div>
                <div class="col-md-4 mb-3">
                    <button class="btn btn-outline-primary w-100 py-3" data-type="voice">
                        üé§ –ì–æ–ª–æ—Å
                    </button>
                </div>
            </div>

            <div id="inputArea" style="display: none;">
                <div class="form-group mb-3">
                    <textarea class="form-control" id="emotionText" rows="3" placeholder="–û–ø–∏—à–∏ —Å–≤–æ–∏ —ç–º–æ—Ü–∏–∏..."></textarea>
                </div>
                <button id="saveEmotion" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>

        <div class="emotion-card p-4">
            <h3 class="mb-4">üìÜ –ò—Å—Ç–æ—Ä–∏—è —ç–º–æ—Ü–∏–π</h3>
            <div class="timeline" id="emotionTimeline">
                <div class="timeline-item">
                    <h5>–î–µ–Ω—å 1</h5>
                    <p>–°–µ–≥–æ–¥–Ω—è —è —á—É–≤—Å—Ç–≤–æ–≤–∞–ª —Å–µ–±—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ!</p>
                    <small class="text-muted">12 –∞–ø—Ä–µ–ª—è 2023</small>
                </div>
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ —ç–º–æ—Ü–∏–π
        const ctx = document.getElementById('emotionChart').getContext('2d');
        const emotionChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['–†–∞–¥–æ—Å—Ç—å', '–ì—Ä—É—Å—Ç—å', '–≠–Ω–µ—Ä–≥–∏—è', '–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ', '–¢—Ä–µ–≤–æ–≥–∞', '–ó–ª–æ—Å—Ç—å'],
                datasets: [{
                    label: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å',
                    data: [85, 20, 70, 60, 30, 15],
                    backgroundColor: 'rgba(138, 79, 255, 0.2)',
                    borderColor: 'rgba(138, 79, 255, 1)',
                    pointBackgroundColor: 'rgba(138, 79, 255, 1)',
                    pointBorderColor: '#fff',
                }]
            },
            options: {
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0,
                        suggestedMax: 100
                    }
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('[data-type]').forEach(btn => {
            btn.addEventListener('click', function() {
                const type = this.getAttribute('data-type');
                document.getElementById('inputArea').style.display = 'block';

                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–≤–æ–¥–∞
            });
        });

        // –ê–Ω–∞–ª–∏–∑ —Ü–µ–ª–∏
        document.getElementById('analyzeGoal').addEventListener('click', function() {
            const goal = document.getElementById('goalText').value;
            if (goal.trim() === '') return;

            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ü–µ–ª–∏
            // –ü–æ–∫–∞–∂–µ–º –∏–º–∏—Ç–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–∞
            const advice = generateAdvice(goal);

            document.getElementById('adviceText').textContent = advice;
            document.getElementById('goalAdvice').style.display = 'block';
        });

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–≤–µ—Ç–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å)
        function generateAdvice(goal) {
            const advices = [
                `–î–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è "${goal}" –ø–æ–ø—Ä–æ–±—É–π —Ä–∞–∑–±–∏—Ç—å —Ü–µ–ª—å –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏.`,
                `–¢—ã –º–æ–∂–µ—à—å –¥–æ—Å—Ç–∏—á—å "${goal}", –µ—Å–ª–∏ –±—É–¥–µ—à—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º.`,
                `–ü–æ–ø—Ä–æ–±—É–π —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –¥–ª—è "${goal}" –∏ –æ—Ç–º–µ—á–∞–π –ø—Ä–æ–≥—Ä–µ—Å—Å.`,
                `–î–ª—è "${goal}" –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏—é - –æ—Ç–º–µ—á–∞–π –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã.`
            ];
            return advices[Math.floor(Math.random() * advices.length)];
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–º–æ—Ü–∏–∏
        document.getElementById('saveEmotion').addEventListener('click', function() {
            const text = document.getElementById('emotionText').value;
            if (text.trim() === '') return;

            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            addTimelineEntry(text);
            document.getElementById('emotionText').value = '';
            document.getElementById('inputArea').style.display = 'none';

            // –û–±–Ω–æ–≤–∏–º –≥—Ä–∞—Ñ–∏–∫ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—É–¥–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–∞)
            updateChartBasedOnText(text);
        });

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
        function addTimelineEntry(text) {
            const timeline = document.getElementById('emotionTimeline');
            const now = new Date();
            const dateStr = now.toLocaleDateString('ru-RU');

            const entry = document.createElement('div');
            entry.className = 'timeline-item mb-3';
            entry.innerHTML = `
                <h5>–î–µ–Ω—å ${timeline.children.length + 1}</h5>
                <p>${text}</p>
                <small class="text-muted">${dateStr}</small>
            `;

            timeline.insertBefore(entry, timeline.firstChild);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function updateChartBasedOnText(text) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞
            const newData = emotionChart.data.datasets[0].data.map(value => {
                return Math.min(100, value + (Math.random() * 20 - 10));
            });

            emotionChart.data.datasets[0].data = newData;
            emotionChart.update();

            // –û–±–Ω–æ–≤–∏–º emoji –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞
            updateEmoji(newData);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ emoji –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
        function updateEmoji(data) {
            const joy = data[0];
            const sadness = data[1];
            const energy = data[2];

            let emoji = 'üòê';
            if (joy > 70 && energy > 60) emoji = 'üòä';
            else if (joy > 60) emoji = 'üôÇ';
            else if (sadness > 60) emoji = 'üòî';
            else if (energy > 70) emoji = 'üòÉ';

            document.querySelector('#todayEmotion .emotion-emoji').textContent = emoji;
        }
    </script>
</body>
</html>